<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital MC System</title>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;

        const Icon = ({ d, className = "w-5 h-5" }) => (
            <svg className={className} fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24">
                <path d={d} />
            </svg>
        );

        const App = () => {
            const [tab, setTab] = useState('doctor');
            const [data, setData] = useState({
                name: '', phone: '', email: '', dob: '', dx: '', start: '', end: '', dr: '', clinic: ''
            });
            const [mc, setMc] = useState(null);
            const [locked, setLocked] = useState(true);
            const [dobIn, setDobIn] = useState('');
            const [copied, setCopied] = useState(false);
            const [sent, setSent] = useState(false);

            const genNum = () => 'MC' + Date.now().toString(36).toUpperCase() + Math.random().toString(36).substring(2, 7).toUpperCase();
            const genUrl = (n) => window.location.origin + window.location.pathname + '?mc=' + n;

            const update = (e) => setData({...data, [e.target.name]: e.target.value});

            const generate = () => {
                if (!data.name || !data.phone || !data.dob || !data.dx || !data.start || !data.end || !data.dr || !data.clinic) {
                    alert('Fill all required fields'); return;
                }
                const num = genNum();
                const url = genUrl(num);
                const newMc = {...data, num, url, date: new Date().toISOString(), hash: btoa(num + data.dob).substring(0, 16)};
                const store = JSON.parse(localStorage.getItem('mcs') || '{}');
                store[num] = newMc;
                localStorage.setItem('mcs', JSON.stringify(store));
                setMc(newMc); setSent(false); setLocked(true); setTab('patient');
            };

            const send = () => { setSent(true); alert(`SMS to ${data.phone}:\n\nMC ready at:\n${mc.url}\n\nUnlock with DOB.`); };
            const unlock = () => { if (dobIn === data.dob) { setLocked(false); setDobIn(''); } else { alert('Wrong DOB'); } };
            const copy = () => { navigator.clipboard.writeText(mc.url); setCopied(true); setTimeout(() => setCopied(false), 2000); };
            const days = () => data.start && data.end ? Math.ceil((new Date(data.end) - new Date(data.start)) / 86400000) + 1 : 0;

            useEffect(() => {
                const params = new URLSearchParams(window.location.search);
                const num = params.get('mc');
                if (num) {
                    const store = JSON.parse(localStorage.getItem('mcs') || '{}');
                    if (store[num]) { setMc(store[num]); setData(store[num]); setTab('patient'); setLocked(true); }
                }
            }, []);

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-50 p-4">
                    <div className="max-w-6xl mx-auto">
                        <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                            <h1 className="text-3xl font-bold text-gray-800">Digital MC System</h1>
                            <p className="text-gray-600">Modern medical certificate management</p>
                        </div>

                        <div className="flex gap-2 mb-6">
                            {[['doctor', 'Doctor Portal'], ['patient', 'Patient View'], ['employer', 'Employer View']].map(([k, t]) => (
                                <button key={k} onClick={() => setTab(k)} disabled={k !== 'doctor' && !mc}
                                    className={`flex-1 py-3 px-6 rounded-lg font-semibold ${tab === k ? 'bg-blue-600 text-white' : 'bg-white text-gray-600'} ${k !== 'doctor' && !mc ? 'opacity-50' : ''}`}>
                                    {t}
                                </button>
                            ))}
                        </div>

                        {tab === 'doctor' && (
                            <div className="bg-white rounded-lg shadow-lg p-8">
                                <h2 className="text-2xl font-bold mb-6">Generate Medical Certificate</h2>
                                <div className="space-y-6">
                                    <div className="border-b pb-6">
                                        <h3 className="text-lg font-semibold mb-4">Patient Information</h3>
                                        <div className="grid md:grid-cols-2 gap-4">
                                            <div><label className="block text-sm font-medium mb-2">Patient Name *</label>
                                                <input type="text" name="name" value={data.name} onChange={update} className="w-full px-4 py-2 border rounded-lg" placeholder="John Doe" /></div>
                                            <div><label className="block text-sm font-medium mb-2">Phone Number *</label>
                                                <input type="tel" name="phone" value={data.phone} onChange={update} className="w-full px-4 py-2 border rounded-lg" placeholder="+63 XXX XXX XXXX" /></div>
                                            <div><label className="block text-sm font-medium mb-2">Email (Optional)</label>
                                                <input type="email" name="email" value={data.email} onChange={update} className="w-full px-4 py-2 border rounded-lg" placeholder="john@example.com" /></div>
                                            <div><label className="block text-sm font-medium mb-2">Date of Birth * (Security)</label>
                                                <input type="date" name="dob" value={data.dob} onChange={update} className="w-full px-4 py-2 border rounded-lg" /></div>
                                        </div>
                                    </div>
                                    <div className="border-b pb-6">
                                        <h3 className="text-lg font-semibold mb-4">Medical Information</h3>
                                        <div className="space-y-4">
                                            <div><label className="block text-sm font-medium mb-2">Diagnosis/Reason *</label>
                                                <textarea name="dx" value={data.dx} onChange={update} rows="3" className="w-full px-4 py-2 border rounded-lg" placeholder="Upper Respiratory Tract Infection" /></div>
                                            <div className="grid md:grid-cols-2 gap-4">
                                                <div><label className="block text-sm font-medium mb-2">MC Start Date *</label>
                                                    <input type="date" name="start" value={data.start} onChange={update} className="w-full px-4 py-2 border rounded-lg" /></div>
                                                <div><label className="block text-sm font-medium mb-2">MC End Date *</label>
                                                    <input type="date" name="end" value={data.end} onChange={update} className="w-full px-4 py-2 border rounded-lg" /></div>
                                            </div>
                                            {data.start && data.end && (
                                                <div className="bg-blue-50 p-4 rounded-lg">
                                                    <p className="text-sm text-blue-800"><strong>Duration:</strong> {days()} day{days() !== 1 ? 's' : ''}</p>
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                    <div>
                                        <h3 className="text-lg font-semibold mb-4">Doctor & Clinic</h3>
                                        <div className="grid md:grid-cols-2 gap-4">
                                            <div><label className="block text-sm font-medium mb-2">Doctor Name *</label>
                                                <input type="text" name="dr" value={data.dr} onChange={update} className="w-full px-4 py-2 border rounded-lg" placeholder="Dr. Maria Santos" /></div>
                                            <div><label className="block text-sm font-medium mb-2">Clinic Name *</label>
                                                <input type="text" name="clinic" value={data.clinic} onChange={update} className="w-full px-4 py-2 border rounded-lg" placeholder="Your Clinic" /></div>
                                        </div>
                                    </div>
                                    <button onClick={generate} className="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-4 px-6 rounded-lg">
                                        Generate Digital Medical Certificate
                                    </button>
                                </div>
                            </div>
                        )}

                        {tab === 'patient' && mc && (
                            <div className="space-y-6">
                                {!sent && (
                                    <div className="bg-white rounded-lg shadow-lg p-6">
                                        <h3 className="text-lg font-semibold mb-4">Send MC to Patient</h3>
                                        <div className="bg-blue-50 p-4 rounded-lg mb-4">
                                            <p className="text-sm mb-2"><strong>MC URL:</strong> {mc.url}</p>
                                            <p className="text-sm"><strong>Patient Phone:</strong> {data.phone}</p>
                                        </div>
                                        <button onClick={send} className="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-6 rounded-lg">
                                            Send SMS to Patient
                                        </button>
                                    </div>
                                )}

                                <div className="bg-white rounded-lg shadow-lg p-8">
                                    {locked ? (
                                        <div className="text-center py-12">
                                            <Icon d="M3 11h18M7 11V7a5 5 0 0110 0v4" className="w-16 h-16 text-gray-400 mx-auto mb-4" />
                                            <h3 className="text-2xl font-bold mb-2">Medical Certificate Locked</h3>
                                            <p className="text-gray-600 mb-6">Enter your date of birth to view MC</p>
                                            <div className="max-w-md mx-auto">
                                                <input type="date" value={dobIn} onChange={(e) => setDobIn(e.target.value)} className="w-full px-4 py-3 border rounded-lg mb-4" />
                                                <button onClick={unlock} className="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg">
                                                    Unlock MC
                                                </button>
                                            </div>
                                        </div>
                                    ) : (
                                        <div>
                                            <h3 className="text-2xl font-bold mb-6">Medical Certificate</h3>
                                            <div className="border-2 rounded-lg p-6 mb-6">
                                                <div className="text-center mb-6 pb-6 border-b">
                                                    <h2 className="text-xl font-bold mb-2">{data.clinic}</h2>
                                                    <p className="text-sm text-gray-600">Digital Medical Certificate</p>
                                                    <p className="text-xs text-gray-500 mt-2">MC Number: {mc.num}</p>
                                                </div>
                                                <div className="space-y-4">
                                                    <div className="grid grid-cols-2 gap-4">
                                                        <div><p className="text-sm text-gray-600">Patient Name</p><p className="font-semibold">{data.name}</p></div>
                                                        <div><p className="text-sm text-gray-600">Date of Birth</p><p className="font-semibold">{new Date(data.dob).toLocaleDateString()}</p></div>
                                                    </div>
                                                    <div><p className="text-sm text-gray-600">Diagnosis</p><p className="font-semibold">{data.dx}</p></div>
                                                    <div className="grid grid-cols-2 gap-4">
                                                        <div><p className="text-sm text-gray-600">MC Start</p><p className="font-semibold">{new Date(data.start).toLocaleDateString()}</p></div>
                                                        <div><p className="text-sm text-gray-600">MC End</p><p className="font-semibold">{new Date(data.end).toLocaleDateString()}</p></div>
                                                    </div>
                                                    <div className="bg-blue-50 p-4 rounded-lg"><p className="text-sm text-blue-800"><strong>Total Days:</strong> {days()}</p></div>
                                                    <div className="pt-4 border-t">
                                                        <p className="text-sm text-gray-600">Issued by</p>
                                                        <p className="font-semibold">{data.dr}</p>
                                                        <p className="text-xs text-gray-500 mt-1">{new Date(mc.date).toLocaleString()}</p>
                                                    </div>
                                                </div>
                                            </div>
                                            <button onClick={copy} className="w-full bg-gray-600 hover:bg-gray-700 text-white font-semibold py-3 px-6 rounded-lg mb-3">
                                                {copied ? 'URL Copied!' : 'Copy MC Link for Employer'}
                                            </button>
                                            <div className="bg-yellow-50 p-4 rounded-lg">
                                                <p className="text-xs text-yellow-800"><strong>Verification:</strong><br/>{mc.url}<br/><span className="text-yellow-700">Hash: {mc.hash}</span></p>
                                            </div>
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}

                        {tab === 'employer' && mc && (
                            <div className="bg-white rounded-lg shadow-lg p-8">
                                <div className="text-center mb-8">
                                    <Icon d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" className="w-16 h-16 text-green-600 mx-auto mb-4" />
                                    <h3 className="text-2xl font-bold mb-2">MC Verification</h3>
                                    <p className="text-gray-600">This medical certificate is authentic</p>
                                </div>
                                <div className="border-2 border-green-200 rounded-lg p-6 bg-green-50 mb-6">
                                    <div className="flex items-center gap-3 mb-4">
                                        <div className="w-12 h-12 bg-green-600 rounded-full flex items-center justify-center">
                                            <Icon d="M20 6L9 17l-5-5" className="w-6 h-6 text-white" />
                                        </div>
                                        <div>
                                            <p className="font-semibold">Verified Medical Certificate</p>
                                            <p className="text-sm text-gray-600">Issued by {data.clinic}</p>
                                        </div>
                                    </div>
                                    <div className="space-y-3">
                                        <div className="grid grid-cols-2 gap-4">
                                            <div><p className="text-sm text-gray-600">Employee</p><p className="font-semibold">{data.name}</p></div>
                                            <div><p className="text-sm text-gray-600">MC Number</p><p className="font-semibold">{mc.num}</p></div>
                                        </div>
                                        <div className="grid grid-cols-2 gap-4">
                                            <div><p className="text-sm text-gray-600">Leave Period</p><p className="font-semibold">{new Date(data.start).toLocaleDateString()} - {new Date(data.end).toLocaleDateString()}</p></div>
                                            <div><p className="text-sm text-gray-600">Total Days</p><p className="font-semibold">{days()}</p></div>
                                        </div>
                                        <div><p className="text-sm text-gray-600">Diagnosis</p><p className="font-semibold">{data.dx}</p></div>
                                        <div><p className="text-sm text-gray-600">Issued By</p><p className="font-semibold">{data.dr}</p><p className="text-xs text-gray-500">{data.clinic}</p></div>
                                    </div>
                                </div>
                                <div className="bg-gray-50 p-4 rounded-lg space-y-2">
                                    <p className="text-xs"><strong>Verification Details:</strong></p>
                                    <p className="text-xs text-gray-600">URL: {mc.url}</p>
                                    <p className="text-xs text-gray-600">Hash: {mc.hash}</p>
                                    <p className="text-xs text-gray-600">Generated: {new Date(mc.date).toLocaleString()}</p>
                                    <p className="text-xs text-gray-500 mt-3">This MC is verified and cannot be forged.</p>
                                </div>
                            </div>
                        )}

                        <div className="mt-8 bg-blue-50 rounded-lg p-6">
                            <h3 className="text-lg font-semibold mb-3">Key Features (DigiMC-inspired)</h3>
                            <div className="grid md:grid-cols-2 gap-3 text-sm">
                                {['DOB Security Lock', 'SMS Delivery', 'Unique URL', 'Easy Sharing', 'Employer Verification', 'Paperless'].map(f => (
                                    <div key={f} className="flex items-start gap-2">
                                        <Icon d="M20 6L9 17l-5-5" className="w-5 h-5 text-blue-600" />
                                        <span>{f}</span>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
